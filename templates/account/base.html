{% load static %} {% get_media_prefix as media_prefix %} {% get_static_prefix as static_prefix %} <!DOCTYPE html> <html lang=en-us  {% block extra-page %}{% endblock %}> <title>{% block title-page %}{% endblock %}</title> {% include "account/inc-meta.html" %} {% include "account/inc-link.html" %} {% block custom-style %}{% endblock %} <link rel=stylesheet  type="text/css" media=screen  href="{% static 'account/css/custom.css' %}?v={{static_version}}" /> <body class=""> {% block header %}{% endblock %} {% block left-panel %}{% endblock %} {% block content %}{% endblock %} {% block footer %}{% endblock %} {% block shortcut %}{% endblock %} {% block scripts %}{% endblock %} <script src="{% static 'account/js/custom.js' %}?v={{static_version}}"></script> <script src="{% static 'js/smartcrop.min.js' %}"></script> <script> function getFileExtension(filename) { const match = filename.match(/\.(\w+)$/); return match ? match[1] : ''; }; $(document).ready(function () { {% if auto_resize %} let auto_resize = true; {% else %} let auto_resize = false; {% endif %} let siteId = {{site_id}}; let uniqueName = 'name'; $("#id_photo-file_path").on("change", function () { if (auto_resize) { const file = event.target.files[0]; if (file && file.type.startsWith('image/')) { smartCropImage(file, ww, hh, (resizedBlob) => { uniqueName = `${siteId}_${new Date().toISOString().replace(/[-:.TZ]/g, '')}`; ext = getFileExtension(file.name); uniqueName = uniqueName + "." + ext; console.log('unique name', uniqueName); const resizedFile = new File([resizedBlob], uniqueName, { type: file.type }); const dataTransfer = new DataTransfer(); dataTransfer.items.add(resizedFile); this.files = dataTransfer.files; }); } else { alert('Please select a valid image file.'); event.target.value = ''; }; } else { if (this.files && this.files[0]) { console.log('inside trigger photo'); var reader = new FileReader(); reader.onload = function (e) { $("#image").attr("src", e.target.result); $("#form-id").val("photo"); $("#modalCrop").modal("show"); }; reader.readAsDataURL(this.files[0]); } } }); $("#id_form-0-file_path").on("change", function () { this.enable = false; if (auto_resize) { const file = event.target.files[0]; if (file && file.type.startsWith('image/')) { smartCropImage(file, ww, hh, (resizedBlob) => { uniqueName = `${siteId}_${new Date().toISOString().replace(/[-:.TZ]/g, '')}`; ext = getFileExtension(file.name); uniqueName = uniqueName + "." + ext; console.log('unique name', uniqueName); const resizedFile = new File([resizedBlob], uniqueName, { type: file.type }); const dataTransfer = new DataTransfer(); dataTransfer.items.add(resizedFile); this.files = dataTransfer.files; }); } else { alert('Please select a valid image file.'); event.target.value = ''; }; } else { if (this.files && this.files[0]) { console.log('inside trigger photo 0'); var reader = new FileReader(); reader.onload = function (e) { $("#image").attr("src", e.target.result); $("#form-id").val("form-0"); $("#modalCrop").modal("show"); }; reader.readAsDataURL(this.files[0]); } } }); $("#id_form-1-file_path").on("change", function () { if (auto_resize) { const file = event.target.files[0]; if (file && file.type.startsWith('image/')) { smartCropImage(file, ww, hh, (resizedBlob) => { uniqueName = `${siteId}_${new Date().toISOString().replace(/[-:.TZ]/g, '')}`; ext = getFileExtension(file.name); uniqueName = uniqueName + "." + ext; console.log('unique name', uniqueName); const resizedFile = new File([resizedBlob], uniqueName, { type: file.type }); const dataTransfer = new DataTransfer(); dataTransfer.items.add(resizedFile); this.files = dataTransfer.files; }); } else { alert('Please select a valid image file.'); event.target.value = ''; }; } else { if (this.files && this.files[0]) { var reader = new FileReader(); reader.onload = function (e) { $("#image").attr("src", e.target.result); $("#form-id").val("form-1"); $("#modalCrop").modal("show"); }; reader.readAsDataURL(this.files[0]); } } }); $("#id_form-2-file_path").on("change", function () { if (auto_resize) { const file = event.target.files[0]; if (file && file.type.startsWith('image/')) { smartCropImage(file, ww, hh, (resizedBlob) => { uniqueName = `${siteId}_${new Date().toISOString().replace(/[-:.TZ]/g, '')}`; ext = getFileExtension(file.name); uniqueName = uniqueName + "." + ext; console.log('unique name', uniqueName); const resizedFile = new File([resizedBlob], uniqueName, { type: file.type }); const dataTransfer = new DataTransfer(); dataTransfer.items.add(resizedFile); this.files = dataTransfer.files; }); } else { alert('Please select a valid image file.'); event.target.value = ''; }; } else { if (this.files && this.files[0]) { var reader = new FileReader(); reader.onload = function (e) { $("#image").attr("src", e.target.result); $("#form-id").val("form-2"); $("#modalCrop").modal("show"); }; reader.readAsDataURL(this.files[0]); } } }); }); </script>